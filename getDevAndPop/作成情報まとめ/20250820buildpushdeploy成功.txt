1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±
é …ç›®	å†…å®¹
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID	polar-xxxxxx-xxxxxx
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒªãƒ¼ã‚¸ãƒ§ãƒ³	Cloud Run / Cloud Scheduler ã§ä½¿ç”¨ã™ã‚‹å ´åˆã«å¿…è¦ï¼ˆä¾‹: asia-northeast1ï¼‰
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¾ãƒ¼ãƒ³	VM ã‚„ Compute Engine ä½¿ç”¨æ™‚ã«å¿…è¦
2. ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
é …ç›®	å†…å®¹
ä½¿ç”¨ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ	polar-xxxxxx@appspot.gserviceaccount.com
IAM æ¨©é™	- roles/storage.objectAdminï¼ˆCloud Storage æ“ä½œç”¨ï¼‰
- roles/editorï¼ˆãã®ä»–åŸºæœ¬æ“ä½œï¼‰
ãƒ¡ãƒ¢	ä»Šå¾Œè¿½åŠ ã§ Cloud Run ç”¨ã«ã‚«ã‚¹ã‚¿ãƒ ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œã‚‹å ´åˆã¯åå‰ã¨æ¨©é™ã‚’è¨˜éŒ²
3. Cloud Storage
é …ç›®	å†…å®¹
ãƒã‚±ãƒƒãƒˆå	ãƒ‡ãƒ¼ã‚¿æ ¼ç´å…ˆã®ãƒã‚±ãƒƒãƒˆåã‚’è¨˜éŒ²
ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™	ä¸Šè¨˜ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ“ä½œå¯èƒ½ã‹ç¢ºèªæ¸ˆã¿
ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ	CSV ãƒ•ã‚¡ã‚¤ãƒ«ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ãªã©ã®æ•´ç†
4. Cloud Run / Docker
é …ç›®	å†…å®¹
ã‚µãƒ¼ãƒ“ã‚¹å	Cloud Run ã‚µãƒ¼ãƒ“ã‚¹åã‚’è¨˜éŒ²
ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸	Artifact Registry ã« push ã—ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ‘ã‚¹
asia-northeast1-docker.pkg.dev/<PROJECT_ID>/<REPO>/<IMAGE>:<TAG>
CPU/ãƒ¡ãƒ¢ãƒª	å®šæœŸå®Ÿè¡Œã«å¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹ï¼ˆä¾‹: 1 CPU, 512MB ãƒ¡ãƒ¢ãƒªï¼‰
ç’°å¢ƒå¤‰æ•°	ã‚¹ã‚¯ãƒªãƒ—ãƒˆå†…ã§å‚ç…§ã™ã‚‹å¤‰æ•°ï¼ˆä¾‹: PROJECT_ID, BUCKET_NAMEï¼‰
5. Cloud Scheduler
é …ç›®	å†…å®¹
ã‚¸ãƒ§ãƒ–å	è¨˜éŒ²ã—ã¦ãŠãã¨å†è¨­å®šã‚„ç·¨é›†ãŒç°¡å˜
å®Ÿè¡Œé–“éš”	ä¾‹: every 30 minutes
å¯¾è±¡	Cloud Run ã‚µãƒ¼ãƒ“ã‚¹ URLï¼ˆHTTP ãƒˆãƒªã‚¬ãƒ¼ï¼‰
èªè¨¼æ–¹æ³•	ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆçµŒç”±ã§å‘¼ã³å‡ºã™å ´åˆã¯å¯¾è±¡ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æŒ‡å®š
6. ã‚¹ã‚¯ãƒªãƒ—ãƒˆæƒ…å ±
é …ç›®	å†…å®¹
Python ã‚¹ã‚¯ãƒªãƒ—ãƒˆå	ä¾‹: process_csv.py
ãƒ©ã‚¤ãƒ–ãƒ©ãƒª	pandas, playwright ãªã©
venv/ä¾å­˜	Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã«å«ã‚ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä¸€è¦§
CSV å…¥åŠ› / å‡ºåŠ›	csv1.csv â†’ csv2.csv ã®ãƒ•ãƒ­ãƒ¼ã€åˆ—ãƒ»è¡Œã®æ‰±ã„ã®ãƒ«ãƒ¼ãƒ«
7. ãƒ­ã‚°ãƒ»ãƒ‡ãƒãƒƒã‚°
é …ç›®	å†…å®¹
Cloud Run ãƒ­ã‚°	gcloud logs read ã§ç¢ºèªå¯èƒ½
Cloud Scheduler ãƒ­ã‚°	å®Ÿè¡Œçµæœã€HTTP ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç¢ºèª
ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆç”¨	python process_csv.py ã§å‹•ä½œç¢ºèªã€Docker ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã®å®Ÿè¡Œç¢ºèª

ğŸ’¡ ãƒ¡ãƒ¢ã®ãƒã‚¤ãƒ³ãƒˆ

ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚„ã‚¤ãƒ¡ãƒ¼ã‚¸åã€ãƒã‚±ãƒƒãƒˆåãªã©ã¯ä¸€è²«ã—ã¦è¨˜éŒ²ã—ã¦ãŠã

Cloud Scheduler ã¨ Cloud Run ã‚’ç´ã¥ã‘ã‚‹éš›ã¯ã€ã‚¸ãƒ§ãƒ–åã¨ã‚µãƒ¼ãƒ“ã‚¹ URL ã‚’å¿˜ã‚Œãªã„

å®šæœŸå®Ÿè¡Œå‰ã«ãƒ­ãƒ¼ã‚«ãƒ«ã§ Docker ã‚³ãƒ³ãƒ†ãƒŠã‚’å‹•ã‹ã—ã¦ãƒ†ã‚¹ãƒˆã—ã¦ãŠãã¨å®‰å…¨

å¿…è¦ã§ã‚ã‚Œã°ã€ã“ã‚Œã‚’ 1æšã®ãƒ¡ãƒ¢è¡¨ ã«ã¾ã¨ã‚ã¦å¾Œæ—¥ã™ãè¦‹ã‚‰ã‚Œã‚‹å½¢ã«ã‚‚ä½œã‚Œã¾ã™ã€‚
ä½œã£ã¦ãŠãã¾ã™ã‹ï¼Ÿ

Microsoft Windows [Version 10.0.19045.6216]
(c) Microsoft Corporation. All rights reserved.

C:\Users\ãƒ¦ãƒ¼ã‚¶ãƒ¼\OneDrive\Desktop\pythonForKeiba\å®šæœŸå®Ÿè¡Œè¡Œã\getDevAndPop(Dockerfile)>gcloud artifacts repositories delete REPO_NAME --location=asia-northeast1 --quiet
ERROR: (gcloud.artifacts.repositories.delete) NOT_FOUND: Requested entity was not found. This command is authenticated as xxxxxx@gmail.com which is the active account specified by the [core/account] property.

C:\Users\ãƒ¦ãƒ¼ã‚¶ãƒ¼\OneDrive\Desktop\pythonForKeiba\å®šæœŸå®Ÿè¡Œè¡Œã\getDevAndPop(Dockerfile)>gcloud config set project polar-xxxxxx
Updated property [core/project].


Updates are available for some Google Cloud CLI components.  To install them,
please run:
  $ gcloud components update


C:\Users\ãƒ¦ãƒ¼ã‚¶ãƒ¼\OneDrive\Desktop\pythonForKeiba\å®šæœŸå®Ÿè¡Œè¡Œã\getDevAndPop(Dockerfile)>gcloud components update
Beginning update. This process may take several minutes.

Restarting command:
  $ gcloud components update


C:\Users\ãƒ¦ãƒ¼ã‚¶ãƒ¼\OneDrive\Desktop\pythonForKeiba\å®šæœŸå®Ÿè¡Œè¡Œã\getDevAndPop(Dockerfile)>gcloud components update
Beginning update. This process may take several minutes.

All components are up to date.

C:\Users\ãƒ¦ãƒ¼ã‚¶ãƒ¼\OneDrive\Desktop\pythonForKeiba\å®šæœŸå®Ÿè¡Œè¡Œã\getDevAndPop(Dockerfile)>gcloud config set project polar-xxxxxx
Updated property [core/project].

C:\Users\ãƒ¦ãƒ¼ã‚¶ãƒ¼\OneDrive\Desktop\pythonForKeiba\å®šæœŸå®Ÿè¡Œè¡Œã\getDevAndPop(Dockerfile)>gcloud services enable run.googleapis.com artifactregistry.googleapis.com pubsub.googleapis.com cloudscheduler.googleapis.com
Operation "xxxxxx" finished successfully.

C:\Users\ãƒ¦ãƒ¼ã‚¶ãƒ¼\OneDrive\Desktop\pythonForKeiba\å®šæœŸå®Ÿè¡Œè¡Œã\getDevAndPop(Dockerfile)>gcloud artifacts repositories create my-docker-repo --repository-format=docker --location=asia-northeast1 --description="Docker repo for Cloud Run service"
Create request issued for: [my-docker-repo]
Waiting for operation [projects/polar-xxxxxx/locations/asia-northeast1/operationsxxxxxx
5082048] to complete...done.
Created repository [my-docker-repo].

C:\Users\ãƒ¦ãƒ¼ã‚¶ãƒ¼\OneDrive\Desktop\pythonForKeiba\å®šæœŸå®Ÿè¡Œè¡Œã\getDevAndPop(Dockerfile)>gcloud builds submit --tag asia-northeast1-docker.pkg.dev/polar-xxxxxx/my-docker-repo/my-service
Creating temporary archive of 3 file(s) totalling 3.8 KiB before compression.
Uploading tarball of [.] to [xxxxxx.tgz]
Created [https://cloudbuild.googleapis.com/v1/projects/polar-xxxxxx/locations/global/builds/xxxxxx].
Logs are available at [ https://console.cloud.google.com/cloud-build/builds/xxxxxx ].
Waiting for build to complete. Polling interval: 1 second(s).
------------------------------------------------- REMOTE BUILD OUTPUT --------------------------------------------------starting build xxxxxxx

