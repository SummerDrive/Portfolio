<!DOCTYPE html>
<html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <title>SummerDriveWebMapTest</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <h3>CSVデータ</h3>
    <div id="header">
      <span class="span1">レースID</span>
      <span class="span1">競馬場</span>
      <span class="span1">レース番号</span>
      <span class="span1">開始時刻</span>
      <span class="span1">頭数</span>
      <span class="span1"></span>
      <span class="span1">予想配当(単勝)</span>
      <span class="span1">予想配当(3連複)</span>
    </div>
    <div id="list"></div>
    <!-- index1.html画面遷移 -->
    <button onclick="location.href='./index1.html'">BACK</button>

    <script>
      const baseUrl = "https://API_KEY.execute-api.ap-northeast-1.amazonaws.com";

        fetch(baseUrl + "/csv")
        .then(response => response.text())
        .then(csvText => {
          const lines = csvText.trim().split("\n");
          const container = document.getElementById("list");

          lines.forEach(line => {
            const columns = line.split(",");

            const row = document.createElement("div");
            row.className = "row";

            for (let i = 0; i < 5; i++) {
              const span = document.createElement("span");
              span.className = "span2";
              span.textContent = columns[i];
              row.appendChild(span);
            }

            const button = document.createElement("button");
            button.textContent = "反映";
            button.onclick = async () => {
              button.disabled = true; // 待機状態（無効化）
              button.innerText = '待機';

              const payload = {
                col2: columns[1],
                col3: columns[2]
              };

              try {
                const response = await fetch(baseUrl + "/getExpDev", {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/json"
                  },
                  body: JSON.stringify(payload)
                });

                const result = await response.json();

                alert("送信成功1: " + result.message);
                alert("送信成功2: " + result.data);
                
                button.disabled = false;
                button.innerText = '反映';
              } catch (error) {
                alert("送信失敗: " + error);

                button.disabled = false;
                button.innerText = '反映';
              }
            };

            row.appendChild(button);

            container.appendChild(row);
          });
        });
    </script>
  </body>
</html>